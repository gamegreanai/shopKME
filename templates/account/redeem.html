{% extends 'base/base.html' %}
{% block title %}DDreamclinic{% endblock %}
{% load static %}
{% block content %}

<!-- ‚úÖ Container ‡∏´‡∏•‡∏±‡∏Å -->
<div class="container py-5 redeem-container">

  <!-- üå∏ ‡∏Å‡∏≤‡∏£‡πå‡∏î Redeem ‡∏´‡∏•‡∏±‡∏Å -->
  <div class="card border-0 shadow-lg rounded-4 redeem-card">
    <div class="card-header text-center text-white py-4">
      <h4 class="fw-bold mb-0">
        <i class="fa fa-gift me-2"></i> ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      </h4>
    </div>

    <div class="card-body p-4">

      <!-- üå∏ ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏ß‡∏• -->
      <div class="member-section p-3 mb-4 rounded-4 text-center text-white">
        <div class="fw-semibold mb-2">
          ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}
        </div>
        <div class="mb-3">
          ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts
        </div>
        <div class="progress mx-auto" style="max-width: 300px; height: 10px;">
          <div class="progress-bar bg-white" style="width: {{ meter.progress_pct }}%;"></div>
        </div>
        <small class="d-block mt-2">
          {% if meter.next_level_name %}
            ‡∏≠‡∏µ‡∏Å {{ meter.remain_to_next }} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô {{ meter.next_level_name }}
          {% else %}
            ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß 
          {% endif %}
        </small>
      </div>

      <!-- üå∏ ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô -->
      <h5 class="fw-bold text-pink mb-3">
        <i class="fa fa-ticket-alt me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
      </h5>
      <div class="row g-3 mb-4">
        {% for r in my_coupons %}
          {% with c=r.coupon %}
          <div class="col-6 col-md-4 col-lg-3">
            <div class="card coupon-card border-0 shadow-sm h-100 rounded-4 overflow-hidden">
              {% if c.image_code and c.image_code.name %}
                <img src="{{ c.image_code.url }}" class="card-img-top" alt="{{ c.code }}">
              {% else %}
                {% include "account/coupon_fall.html" with c=c theme="cpn--light" %}
              {% endif %}
              <div class="card-body d-flex flex-column p-2">
                <h6 class="fw-bold text-pink small">{{ c.name }}</h6>
                <div class="small text-muted mb-1">‡πÅ‡∏•‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ r.created_at|date:"Y-m-d H:i" }}</div>
                <div class="small text-muted mb-2">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: {{ c.ends_at|default:"-" }}</div>
                <div class="input-group input-group-sm mt-auto">
                  <input type="text" class="form-control" value="{{ c.code }}" readonly>
                  <button type="button" class="btn btn-pink"
                    onclick="navigator.clipboard.writeText('{{ c.code }}')">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                </div>
              </div>
            </div>
          </div>
          {% endwith %}
        {% empty %}
          <div class="col-12 text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏ß‡πâ</div>
        {% endfor %}
      </div>

      <!-- üå∏ ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ -->
      <h5 class="fw-bold text-pink mb-3">
        <i class="fa fa-gift me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ
      </h5>
      <div class="row g-3 mb-4">
        {% for c in available %}
        <div class="col-6 col-md-4 col-lg-3">
          <div class="card coupon-card border-0 shadow-sm h-100 rounded-4 overflow-hidden">
            {% if c.image and c.image_code %}
              <img src="{{ c.image.url }}" class="card-img-top" alt="{{ c.code }}">
            {% elif c.active %}
              {% include "account/coupon_fall.html" with c=c theme="cpn--teal" %}
            {% else %}
              {% include "account/coupon_fall.html" with c=c theme="cpn--light" %}
            {% endif %}
            <div class="card-body d-flex flex-column p-2">
              <h6 class="fw-bold text-pink small">{{ c.name }}</h6>
              <div class="small text-muted mb-1">‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <strong>{{ c.req_pts }}</strong></div>
              <div class="small mb-2 text-secondary">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: {{ c.expires_at|default:"-" }}</div>
              <div class="mt-auto d-grid">
                <form method="post">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="redeem">
                  <input type="hidden" name="coupon_id" value="{{ c.id }}">
                  <button class="btn btn-pink btn-sm fw-semibold"
                    {% if not c.can_use or not c.enough_points %} disabled {% endif %}>
                    ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
                  </button>
                </form>
                {% if not c.active %}
                  <div class="form-text text-danger small">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</div>
                {% elif not c.enough_points %}
                  <div class="form-text text-warning small">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12 text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏Å</div>
        {% endfor %}
      </div>

      <!-- üå∏ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å -->
      <h5 class="fw-bold text-pink mb-3">
        <i class="fa fa-history me-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å
      </h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center">
          <thead class="table-pink">
            <tr>
              <th>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</th>
              <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
            </tr>
          </thead>
          <tbody>
            {% for r in redemptions %}
            <tr>
              <td class="text-start">
                {% if r.coupon.image %}
                  <img src="{{ r.coupon.image.url }}" class="me-2 rounded" style="width:36px;height:auto;">
                {% endif %}
                {{ r.coupon.code }}
              </td>
              <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
              <td>{{ r.order_id|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<!-- üå∏ CSS -->
<style>
  body {
    background-color: #f8f9fa;
  }

  /* üå∏ ‡∏™‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå */
input[name="phone"] {
  color: #ff008b !important;                /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
  font-weight: 600;                         /* ‡∏´‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ä‡∏±‡∏î */
  border-color: #ff66c8 !important;         /* ‡∏Ç‡∏≠‡∏ö‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô */
  transition: all 0.3s ease-in-out;
}

input[name="phone"]:focus {
  border-color: #ff008b !important;         /* ‡∏Ç‡∏≠‡∏ö‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°‡∏ï‡∏≠‡∏ô focus */
  box-shadow: 0 0 6px rgba(255, 0, 139, 0.4) !important; /* ‡πÄ‡∏á‡∏≤‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏£‡∏∑‡∏≠‡∏á */
  color: #ff008b !important;                /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ä‡∏°‡∏û‡∏π */
  outline: none;
}


  .redeem-container {
    margin-top: clamp(110px, 10vw, 130px);
    max-width: 1000px;
  }

  .redeem-card {
    border-radius: 20px;
    background: #fff;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .redeem-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 0, 139, 0.1);
  }

  .redeem-card .card-header {
    background: linear-gradient(135deg, #ff008b, #ff66c8);
    border: none;
  }

  .text-pink {
    color: #ff008b !important;
  }

  .btn-pink {
    background-color: #ff008b !important;
    color: #fff !important;
    border-radius: 30px;
    border: none;
    transition: 0.3s;
  }

  .btn-pink:hover {
    background-color: #ff66c8 !important;
    box-shadow: 0 4px 10px rgba(255, 102, 200, 0.3);
  }

  .table-pink {
    background-color: #ffe6f5;
    color: #ff008b;
  }

  .member-section {
    background: linear-gradient(135deg, #ff008b, #ff66c8);
  }

  .coupon-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .coupon-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(255, 0, 0, 0.1);
  }

  /* Responsive */
  @media (max-width: 991px) {
    .redeem-container {
      margin-top: 115px;
      padding: 1.5rem;
    }
    .redeem-card .card-header h4 {
      font-size: 1.2rem;
    }
  }

  @media (max-width: 768px) {
    .redeem-container {
      margin-top: 100px !important;
      padding: 1rem !important;
    }
    .redeem-card {
      border-radius: 16px;
    }
    .redeem-card .card-header h4 {
      font-size: 1.1rem;
    }
    .coupon-card h6 {
      font-size: 0.9rem;
    }
  }
</style>

{% endblock %}
