{% extends 'base/base.html' %}
{% block title %}DDreamclinic{% endblock %}
{% load static %} 
{% block content %}

{% comment %} <!-- ‚úÖ Container ‡∏´‡∏•‡∏±‡∏Å --> {% endcomment %}
<div class="container py-3 redeem-container">
  <div class="card border-0 shadow-sm overflow-hidden position-relative member-bg">
    <div class="overlay position-absolute top-0 start-0 w-100 h-100"></div>
    <div class="card-body d-flex flex-column flex-md-row align-items-start justify-content-between position-relative member-content" >

      <div class="d-flex flex-column align-items-start gap-3 member-left">
        <div class="member-info d-flex align-items-center flex-wrap">
          <span class="badge rounded-pill shadow-sm fw-bold member-badge d-flex align-items-center gap-2" >
            {% if meter.level == "Silver" %}
            <i class="fa fa-medal level-icon text-silver"></i>
            {% elif meter.level == "Gold" %}
            <i class="fa fa-medal level-icon text-gold"></i>
            {% else %}
            <i class="fa fa-crown level-icon text-premium"></i>
            {% endif %} ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}
          </span>
        </div>
        <p class=" mb-0 member-points"> ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts </p>

        <div class="progress-wrapper w-100" style="max-width: 200px">
          <div class="d-flex justify-content-between small mb-1 member-progress-text" >
            <span>{{ meter.level }}</span>
            <span>{{ meter.progress_pct }}%</span>
          </div>
          <div class="progress bg-light bg-opacity-50 member-progress-bar">
            <div class="progress-bar member-progress" style="width: {{ meter.progress_pct }}%" >
            </div>
          </div>
          <div class="small fw-semibold member-progress-text">
            {% if meter.next_level_name %} ‡∏≠‡∏µ‡∏Å
            <strong>{{ meter.remain_to_next }}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô
            <strong>{{ meter.next_level_name }}</strong>
            {% else %} ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <br>
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
  </h6>
</div>
  <hr>
  {% comment %} <!-- üéüÔ∏è ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
  </h6>
</div>
  <div class="row g-3 mb-4">
    {% for r in my_coupons %} {% with c=r.coupon %}
    <div class="col-6 col-md-4 col-lg-3">
      <div class="card coupon-card border-0 shadow-sm h-100 rounded-4 overflow-hidden" 
           style="cursor:pointer;"
           data-bs-toggle="modal"
           data-bs-target="#myCouponModal"
           data-coupon-id="{{ c.id }}"
           data-coupon-code="{{ c.code }}"
           data-coupon-name="{{ c.name }}"
           data-coupon-note="{{ c.note|default:'' }}"
           data-coupon-partner="{{ c.partner.name }}"
           data-coupon-branches="{{ c.partner.available_branches|default:'‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤' }}"
           data-coupon-ends="{{ c.ends_at|date:'c' }}"
           data-redemption-created="{{ r.created_at|date:'c' }}"
           data-image-code="{% if c.image_code %}{{ c.image_code.url }}{% endif %}">
        {% if c.image_code and c.image_code.name %}
        <img src="{{ c.image_code.url }}" class="card-img-top" alt="{{ c.code }}" />
        {% else %} {% include "account/coupon_fall.html" with c=c theme="cpn--light" %} {% endif %}
        
        <div class="card-body d-flex flex-column p-2">
          <div class="input-group input-group-sm mt-auto">
            <input type="text" class="form-control" value="{{ c.code }}" readonly onclick="event.stopPropagation()" />
            <button type="button" class="btn btn-pink" onclick="event.stopPropagation(); navigator.clipboard.writeText('{{ c.code }}')">
              ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endwith %} {% empty %}
    <div class="col-12 text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏ß‡πâ</div>
    {% endfor %}
  </div>
  <hr />
  {% comment %} <!-- üéÅ ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ
  </h6>
</div>
  
  {# ---- Top category tabs: ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏î‡∏µ‡∏î‡∏£‡∏µ‡∏° / ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå ---- #}
  <div class="d-flex justify-content-center mb-3">
    <ul class="nav nav-pills gap-2 coupon-top-tabs">
      <li class="nav-item">
        <button class="nav-link active coupon-top-tab" data-target="tab-dream">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏î‡∏µ‡∏î‡∏£‡∏µ‡∏°</button>
      </li>
      <li class="nav-item">
        <button class="nav-link coupon-top-tab" data-target="tab-partner">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå</button>
      </li>
    </ul>
  </div>

  {# ---- Sub tabs inside coupon: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î / ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì / ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ---- #}
  <div class="d-flex justify-content-center mb-3 coupon-filter-tabs-wrapper">
    <ul class="nav nav-pills gap-2 coupon-filter-tabs">
      <li class="nav-item"><button class="nav-link active coupon-filter-tab" data-filter="panel-all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></li>
      <li class="nav-item"><button class="nav-link coupon-filter-tab" data-filter="panel-for-you">‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</button></li>
      <li class="nav-item"><button class="nav-link coupon-filter-tab" data-filter="panel-used">‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</button></li>
    </ul>
  </div>

  {# ---- Coupon Slide Carousel Preview ---- #}
  {% if image_pairs %}
  <div class="card border-0 mb-4 overflow-hidden" style="background-color: #f8f9fa;">
    <div id="couponSlideCarouselRedeem" class="carousel slide" data-bs-ride="carousel" data-bs-wrap="true">
      <div class="carousel-inner">
        {% for pair in image_pairs %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="row g-0 m-0">
              <!-- ‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å -->
              <div class="col-6 p-0 {% if pair.first.partner %}coupon-slide-clickable{% endif %}" 
                   {% if pair.first.partner %}onclick="showPartnerPopupRedeem({{ pair.first.partner.id }})"{% endif %}
                   style="{% if pair.first.partner %}cursor: pointer;{% endif %}">
                <img src="{{ pair.first.image.url }}" alt="{{ pair.first.name }}" class="w-100 h-100" style="object-fit: cover;">
              </div>
              <!-- ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á -->
              <div class="col-6 p-0 {% if pair.second and pair.second.partner %}coupon-slide-clickable{% endif %}"
                   {% if pair.second and pair.second.partner %}onclick="showPartnerPopupRedeem({{ pair.second.partner.id }})"{% endif %}
                   style="{% if pair.second and pair.second.partner %}cursor: pointer;{% endif %}">
                {% if pair.second %}
                  <img src="{{ pair.second.image.url }}" alt="{{ pair.second.name }}" class="w-100 h-100" style="object-fit: cover;">
                {% else %}
                  <div class="d-flex align-items-center justify-content-center bg-light h-100">
                    <p class="text-muted mb-0">-</p>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      
      <!-- Carousel Controls -->
      <button class="carousel-control-prev" type="button" data-bs-target="#couponSlideCarouselRedeem" data-bs-slide="prev" style="width: 8%;">
        <i class="fa fa-chevron-left" style="color: #ff008b; font-size: 2rem;"></i>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#couponSlideCarouselRedeem" data-bs-slide="next" style="width: 8%;">
        <i class="fa fa-chevron-right" style="color: #ff008b; font-size: 2rem;"></i>
        <span class="visually-hidden">Next</span>
      </button>
      
      <!-- Carousel Indicators -->
      <div class="carousel-indicators">
        {% for pair in image_pairs %}
          <button type="button" data-bs-target="#couponSlideCarouselRedeem" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %}></button>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  {# ---- Panels container (top: dream / partner) ---- #}
  <div id="tab-dream" class="coupon-top-panel">
    <div id="panel-all" class="coupon-filter-panel">
      {# ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î DDream - ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (2 columns) #}
      {% if partners_by_category.ddream_all %}
      <div class="row g-3 mb-4">
        {% for p in partners_by_category.ddream_all %}
        <div class="col-12 col-md-6">
          <div class="card border-0 shadow-sm rounded-4 overflow-hidden partner-card-horizontal" 
               style="cursor:pointer;"
               data-bs-toggle="modal" 
               data-bs-target="#partnerModal"
               data-partner-id="{{ p.id }}"
               data-partner-name="{{ p.name }}"
               data-partner-title="{{ p.title }}"
               data-partner-logo="{% if p.logo %}{{ p.logo.url }}{% endif %}"
               data-partner-branches="{{ p.available_branches }}"
               data-partner-expires="">
            <div class="row g-0">
              <div class="col-4">
                {% if p.logo %}
                <img src="{{ p.logo.url }}" class="w-100 h-100" alt="{{ p.name }}" style="object-fit:cover;">
                {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                  <i class="fa fa-image fa-3x text-muted"></i>
                </div>
                {% endif %}
              </div>
              <div class="col-8">
                <div class="card-body d-flex flex-column justify-content-between h-100 p-3">
                  <div>
                    <p class="text-dark mb-2 fw-bold">{{ p.title|default:p.name }}</p>
                    <p class="text-muted mb-2 small">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
                    <p class="text-success mb-0 fw-bold"><span class="partner-coupon-count-{{ p.id }}">-</span></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted my-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</div>
      {% endif %}
    </div>

    <div id="panel-for-you" class="coupon-filter-panel d-none">
      {# ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î DDream - ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì #}
      {% if partners_by_category.ddream_special %}
      <div class="row g-3 mb-4">
        {% for p in partners_by_category.ddream_special %}
        <div class="col-12">
          <div class="card border-0 shadow-sm rounded-4 overflow-hidden partner-card-horizontal" 
               style="cursor:pointer;"
               data-bs-toggle="modal" 
               data-bs-target="#partnerModal"
               data-partner-id="{{ p.id }}"
               data-partner-name="{{ p.name }}"
               data-partner-title="{{ p.title }}"
               data-partner-logo="{% if p.logo %}{{ p.logo.url }}{% endif %}"
               data-partner-branches="{{ p.available_branches }}"
               data-partner-expires="">
            <div class="row g-0">
              <div class="col-4 col-md-3">
                {% if p.logo %}
                <img src="{{ p.logo.url }}" class="w-100 h-100" alt="{{ p.name }}" style="object-fit:cover;">
                {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                  <i class="fa fa-image fa-3x text-muted"></i>
                </div>
                {% endif %}
              </div>
              <div class="col-8 col-md-9">
                <div class="card-body d-flex flex-column justify-content-between h-100 p-3">
                  <div>
                    <span class="badge bg-warning text-dark mb-2 px-3 py-2">‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</span>
                    <p class="text-dark mb-2 fw-bold">{{ p.title|default:p.name }}</p>
                    <p class="text-muted mb-2 small">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
                    <p class="text-success mb-0 fw-bold"><span class="partner-coupon-count-{{ p.id }}">-</span></p>
                  </div>
                  <div class="d-flex justify-content-end align-items-center mt-2">
                    <button class="btn btn-pink rounded-pill px-4">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted my-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</div>
      {% endif %}
    </div>

    <div id="panel-used" class="coupon-filter-panel d-none">
      {# ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î DDream - ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ #}
      {% if partners_by_category.ddream_used %}
      <div class="row g-3 mb-4">
        {% for p in partners_by_category.ddream_used %}
        <div class="col-12">
          <div class="card border-0 shadow-sm rounded-4 overflow-hidden partner-card-horizontal" 
               style="cursor:pointer;"
               data-bs-toggle="modal" 
               data-bs-target="#partnerModal"
               data-partner-id="{{ p.id }}"
               data-partner-name="{{ p.name }}"
               data-partner-title="{{ p.title }}"
               data-partner-logo="{% if p.logo %}{{ p.logo.url }}{% endif %}"
               data-partner-branches="{{ p.available_branches }}"
               data-partner-expires="">
            <div class="row g-0">
              <div class="col-4 col-md-3">
                {% if p.logo %}
                <img src="{{ p.logo.url }}" class="w-100 h-100" alt="{{ p.name }}" style="object-fit:cover;">
                {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                  <i class="fa fa-image fa-3x text-muted"></i>
                </div>
                {% endif %}
              </div>
              <div class="col-8 col-md-9">
                <div class="card-body d-flex flex-column justify-content-between h-100 p-3">
                  <div>
                    <span class="badge bg-secondary mb-2 px-3 py-2">‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
                    <p class="text-dark mb-2 fw-bold">{{ p.title|default:p.name }}</p>
                    <p class="text-muted mb-2 small">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
                    <p class="text-success mb-0 fw-bold"><span class="partner-coupon-count-{{ p.id }}">-</span></p>
                  </div>
                  <div class="d-flex justify-content-end align-items-center mt-2">
                    <button class="btn btn-pink rounded-pill px-4" disabled>‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted my-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</div>
      {% endif %}
    </div>
  </div>

  <div id="tab-partner" class="coupon-top-panel d-none">
    {# ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î Partner #}
    {% if partners_by_category.partner %}
    <div class="row g-3 mb-4">
      {% for p in partners_by_category.partner %}
      <div class="col-12">
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden partner-card-horizontal" 
             style="cursor:pointer;"
             data-bs-toggle="modal" 
             data-bs-target="#partnerModal"
             data-partner-id="{{ p.id }}"
             data-partner-name="{{ p.name }}"
             data-partner-title="{{ p.title }}"
             data-partner-logo="{% if p.logo %}{{ p.logo.url }}{% endif %}"
             data-partner-branches="{{ p.available_branches }}"
             data-partner-expires="">
          <div class="row g-0">
            <div class="col-4 col-md-3">
              {% if p.logo %}
              <img src="{{ p.logo.url }}" class="w-100 h-100" alt="{{ p.name }}" style="object-fit:cover;">
              {% else %}
              <div class="bg-light d-flex align-items-center justify-content-center h-100">
                <i class="fa fa-image fa-3x text-muted"></i>
              </div>
              {% endif %}
            </div>
            <div class="col-8 col-md-9">
              <div class="card-body d-flex flex-column justify-content-between h-100 p-3">
                <div>
                  <p class="text-pink mb-2 fw-bold">{{ p.available_branches|default:"(‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤)" }}</p>
                  <p class="text-dark mb-4">{{ p.title|default:"" }}</p>
                  <p class="text-muted mb-0">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ : <span class="partner-expiry-{{ p.id }}">-</span></p>
                </div>
                <div class="d-flex justify-content-end align-items-center mt-2">
                  <button class="btn btn-pink rounded-pill px-4">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-muted my-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå</div>
    {% endif %}
  </div>

  <hr>
  
  {% comment %} <!-- Modal ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô --> {% endcomment %}
  <div class="modal fade" id="myCouponModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title fw-bold" id="myCouponPartnerName"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body px-4 pb-4">
          {# ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ #}
          <div class="bg-success bg-opacity-10 rounded-3 p-2 mb-3 text-center">
            <span class="badge bg-success px-3 py-2">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</span>
          </div>
          
          {# ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á #}
          <h6 class="fw-bold mb-3 text-center" id="myCouponName"></h6>
          
          {# ‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• #}
          <div class="bg-light rounded-3 p-3 mb-3">
            <p class="text-muted mb-2 small text-center">‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
            <div class="d-flex align-items-center justify-content-center gap-2">
              <h4 class="text-success mb-0 fw-bold" id="myCouponCode"></h4>
              <button class="btn btn-sm btn-outline-secondary" onclick="copyCouponCode()">
                <i class="fa fa-copy"></i>
              </button>
            </div>
          </div>
          
          {# ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• #}
          <div class="mb-3">
            <p class="text-muted mb-1 small">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</p>
            <p class="mb-0" id="myCouponBranches"></p>
          </div>
          
          {# ‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏Å #}
          <div class="mb-3">
            <p class="text-muted mb-1 small">‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏Å:</p>
            <p class="mb-0 fw-bold" id="myCouponPoints"></p>
          </div>
          
          {# ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å #}
          <div class="mb-3">
            <p class="text-muted mb-1 small">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å:</p>
            <p class="mb-0" id="myCouponRedeemed"></p>
          </div>
          
          {# ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ #}
          <div class="mb-3">
            <p class="text-muted mb-1 small">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏:</p>
            <p class="mb-0" id="myCouponExpiry"></p>
          </div>
          
          {# ‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• #}
          <div class="text-center">
            <p class="text-muted mb-2 small">‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
            <div class="d-flex justify-content-center">
              <img id="myCouponQR" src="" alt="QR Code" class="img-fluid" style="max-width: 180px;">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {% comment %} <!-- Modal ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå --> {% endcomment %}
  <div class="modal fade" id="partnerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-body p-0">
          {# ‡∏£‡∏π‡∏õ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå #}
          <div class="position-relative">
            <img id="modalPartnerLogo" src="" alt="Partner Logo" class="w-100" style="max-height:180px;object-fit:contain;background-color:#f8f9fa;">
            <button type="button" class="btn-close position-absolute top-0 end-0 m-3 bg-white rounded-circle p-2" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="p-2">
            {# ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏Å #}
            <h5 class="text-center mb-3">
              ‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏¢‡∏ó‡πå‡πÅ‡∏•‡∏Å <span id="modalCouponPointsDisplay" style="color: #ff008b; font-weight: bold;">0</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            </h5>
            <span id="modalPartnerName" style="display:none;"></span>
            <span id="modalPartnerTitle" style="display:none;"></span>
            
            {# ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î #}
            <div class="bg-light rounded-3 p-1 mb-1">
              <h6 class="text-muted mb-2"><i class="fa fa-clock me-2"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</h6>
              <div id="modalCouponExpiry" class="d-flex justify-content-center gap-3">
                <div class="text-center">
                  <div class="fw-bold fs-4" id="expiryDays">--</div>
                  <small class="text-muted">‡∏ß‡∏±‡∏ô</small>
                </div>
                <div class="text-center">
                  <div class="fw-bold fs-4" id="expiryHours">--</div>
                  <small class="text-muted">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</small>
                </div>
                <div class="text-center">
                  <div class="fw-bold fs-4" id="expiryMinutes">--</div>
                  <small class="text-muted">‡∏ô‡∏≤‡∏ó‡∏µ</small>
                </div>
                <div class="text-center">
                  <div class="fw-bold fs-4" id="expirySeconds">--</div>
                  <small class="text-muted">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</small>
                </div>
              </div>
            </div>
            
            {# ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ #}
            <div class="border rounded-3 p-1 mb-3">
              <div class="text-center mb-1">
                <small class="text-muted">‡πÅ‡∏à‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong id="modalTotalCoupons">5</strong> ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏•‡∏≠‡∏î‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ô</small>
              </div>
              <div class="progress position-relative" style="height:35px; border-radius:20px; background-color:#d3d3d3;">
                <div class="progress-bar d-flex align-items-center justify-content-center fw-bold" 
                     id="modalCouponProgress" 
                     style="width:80%; background-color:#ff008b; border-radius:20px;">
                  <span class="text-white">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                </div>
                <div class="position-absolute top-50 end-0 translate-middle-y me-3">
                  <small class="text-white fw-bold"><span id="modalCouponPercent">80</span>%</small>
                </div>
              </div>
            </div>
            
            {# ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î #}
            <div class="mb-4">
              <h6 class="fw-semibold mb-2"><i class="fa fa-info-circle me-2"></i>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</h6>
              <div class="small text-muted" id="modalCouponDetails">
                <div id="modalBranches"></div>
              </div>
            </div>
            
            {# ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• #}
            <button class="btn w-100 fw-semibold py-3 rounded-3" id="btnUseCoupon" data-coupon-id="" data-coupon-points="" style="background-color: #ff008b; color: white; border: none;">
              ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {% comment %} <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å --> {% endcomment %}
  <div class="modal fade" id="confirmRedeemModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-body p-4 text-center">
          <h5 class="fw-bold mb-3">‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ?</h5>
          <p class="text-muted mb-4" id="confirmMessage">
            ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å ‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å <strong id="confirmPoints">100</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br>
            ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠<br>
            ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ
          </p>
          
          <form method="post" id="confirmRedeemForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="redeem">
            <input type="hidden" name="coupon_id" id="confirmCouponId">
            
            <button type="submit" class="btn btn-success w-100 fw-semibold py-2 rounded-3 mb-2">
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            </button>
            <button type="button" class="btn btn-outline-secondary w-100 fw-semibold py-2 rounded-3" data-bs-dismiss="modal">
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  {% comment %} <!--  ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å
  </h6>
</div>
  <div class="table-responsive">
    <table class="table table-hover align-middle text-center">
      <thead class="table-pink">
        <tr>
          <th>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</th>
          <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
          {% comment %} <th>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th> {% endcomment %}
        </tr>
      </thead>
      <tbody>
        {% for r in redemptions %}
        <tr>
          <td class="text-start">
            {% if r.coupon.image %}
            <img
              src="{{ r.coupon.image.url }}"
              class="me-2 rounded"
              style="width: 36px; height: auto"
            />
            {% endif %} {{ r.coupon.code }}
          </td>
          <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
          {% comment %} <td>{{ r.order_id|default:"-" }}</td> {% endcomment %}
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<style>
  body {
    background-color: #f8f9fa;
  }

  .redeem-container {
    margin-top: 120px;
    margin-left: 120px;
    max-width: calc(100% - 240px);
    padding: 2rem;
    transition: all 0.3s ease;
  }

  hr {
    border: none;
    border-top: 2px solid #ff008b;
    margin: 1.5rem 0;
    opacity: 0.5;
  }

  .btn-pink {
    background-color: #ff008b !important;
    color: #fff !important;
    border-radius: 5px;
    border: none;
    transition: 0.3s;
  }

  .btn-pink:hover {
    background-color: #ff66c8 !important;
    box-shadow: 0 4px 10px rgba(255, 102, 200, 0.3);
  }

  /* Coupon Slide Images */
  .coupon-slide-container {
    max-width: 100%;
    margin: 0 auto;
  }

  .coupon-slide-container .card {
    transition: transform 0.2s ease;
  }

  .coupon-slide-container .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(255, 0, 139, 0.2) !important;
  }

  .coupon-slide-container img {
    transition: transform 0.3s ease;
  }

  .coupon-slide-container .card:hover img {
    transform: scale(1.05);
  }

  /* Tabs styling */
  .nav-pills .nav-link { color: #ff008b; border: 1px solid #ff008b; }
  .nav-pills .nav-link.active { background-color: #ff008b; color: #fff; }

  .member-bg {
    aspect-ratio: 2 / 1;
    width: 100%;
    border-radius: 0.75rem;
    background-image: url("/media/gardDM.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
    color: white;
    overflow: hidden;
    transition: all 0.3s ease;
    filter: brightness(1.1);
    box-shadow: 0 4px 15px rgba(255, 0, 139, 0.15);
  }

  .member-bg .overlay {
    background: rgba(0, 0, 0, 0.08);
    z-index: 1;
  }

  .member-content {
    z-index: 2;
    padding: clamp(1rem, 3vw, 2.5rem);
  }

  .member-badge {
    font-size: 1.25rem !important;
    padding: 0.75rem 1.5rem !important;
    border-radius: 2rem !important;
  }

  .level-icon {
    font-size: 1.5rem !important;
  }

  .member-points {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .member-bg .member-points,
  .member-bg .member-progress-text,
  .member-bg .member-badge,
  .member-bg strong,
  .member-bg span,
  .member-bg p,
  .member-bg h6,
  .member-bg h5 {
    color: #996633 !important;
    text-shadow: 0 1px 2px rgba(200, 213, 8, 0.15);
  }

  .progress {
    border-radius: 8px;
    height: 8px;
  }

  .member-progress {
    background: linear-gradient(90deg, #eb8511ff, #f8bb2fff);
    border-radius: 8px;
  }

  .text-silver {
    color: #c0c0c0;
  }

  .text-gold {
    color: #ffd700;
  }

  .text-premium {
    color: #ff66c8;
  }

  /* ‡∏£‡∏π‡∏õ preview ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ */
  .partner-card-horizontal img {
    object-fit: contain !important;
    background-color: #f8f9fa !important;
  }

  /* ‡∏ã‡πà‡∏≠‡∏ô modal backdrop ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  .modal-backdrop {
    display: none !important;
  }
  
  /* Responsive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï */
  @media (max-width: 768px) {
    /* Modal ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á viewport (‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π) */
    .modal.show .modal-dialog {
      position: fixed !important;
      top: 40vh !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin: 0 !important;
      width: calc(100vw - 1rem) !important;
      max-width: calc(100vw - 1rem) !important;
      max-height: 90vh !important;
    }
    
    .modal.show .modal-content {
      max-height: 90vh !important;
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
      border-radius: 1rem !important;
    }
    
    /* Lock scroll body ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î modal */
    body.modal-open {
      overflow: hidden !important;
      position: fixed !important;
      width: 100% !important;
    }
    
    /* ‡∏£‡∏π‡∏õ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÉ‡∏ô Modal - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    #partnerModal #modalPartnerLogo {
      max-height: 320px !important;
      width: 100% !important;
      object-fit: contain !important;
      border-radius: 0.5rem !important;
      background-color: #f8f9fa !important;
    }
    
    /* Header ‡πÅ‡∏•‡∏∞ Title */
    h6, .h6 {
      font-size: 0.875rem !important;
    }
    
    h5, .h5 {
      font-size: 1rem !important;
    }
    
    /* Member Card */
    .member-badge {
      font-size: 0.7rem !important;
      padding: 0.25rem 0.5rem !important;
      border-radius: 1rem !important;
    }

    .member-points {
      font-size: 0.7rem !important;
      max-width: 100%;
    }

    .level-icon {
      font-size: 0.75rem !important;
    }

    .member-bg .member-content {
      font-size: 0.5rem !important;
      padding: 0.6rem 0.8rem !important;
      line-height: 1.2 !important;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .member-bg strong,
    .member-bg span,
    .member-bg small,
    .member-bg .member-progress-text {
      font-size: 0.6rem !important;
      line-height: 1.2 !important;
    }

    .member-points {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .member-bg .progress {
      height: 5px !important;
      border-radius: 5px !important;
    }
    
    /* Navigation Tabs */
    .nav-pills .nav-link {
      font-size: 0.75rem !important;
      padding: 0.4rem 0.8rem !important;
    }
    
    /* Coupon Cards */
    .card-body {
      padding: 0.75rem !important;
    }
    
    .card-body p,
    .card-body .small {
      font-size: 0.75rem !important;
    }
    
    .card-body .fw-bold {
      font-size: 0.8rem !important;
    }
    
    .input-group input,
    .input-group button {
      font-size: 0.75rem !important;
      padding: 0.25rem 0.5rem !important;
    }
    
    /* Partner Cards - DDream ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    #panel-all > .row {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 0.75rem !important;
      grid-auto-flow: row !important;
    }
    
    #panel-all .col-12 {
      grid-column: auto !important;
    }
    
    /* ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏£‡∏π‡∏õ‡∏ö‡∏ô ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏á */
    #panel-all .partner-card-horizontal .row.g-0 {
      display: flex !important;
      flex-direction: column !important;
    }
    
    #panel-all .partner-card-horizontal .col-4,
    #panel-all .partner-card-horizontal .col-8 {
      flex: 0 0 100% !important;
      max-width: 100% !important;
      width: 100% !important;
    }
    
    #panel-all .partner-card-horizontal img,
    #panel-all .partner-card-horizontal .bg-light {
      height: 120px !important;
      object-fit: contain !important;
      background-color: #f8f9fa !important;
    }
    
    #panel-all .partner-card-horizontal .card-body {
      padding: 0.5rem !important;
      min-height: auto !important;
    }
    
    #panel-all .partner-card-horizontal p {
      font-size: 0.65rem !important;
      margin-bottom: 0.2rem !important;
    }
    
    /* Partner Cards - ‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì, ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß) */
    .partner-card-horizontal .card-body {
      padding: 0.5rem !important;
    }
    
    .partner-card-horizontal p {
      font-size: 0.7rem !important;
      margin-bottom: 0.25rem !important;
    }
    
    .partner-card-horizontal .btn {
      font-size: 0.7rem !important;
      padding: 0.3rem 0.8rem !important;
    }
    
    /* Table */
    .table {
      font-size: 0.75rem !important;
    }
    
    .table th,
    .table td {
      font-size: 0.7rem !important;
      padding: 0.4rem 0.3rem !important;
    }

    .table img {
      width: 24px !important;
      height: auto !important;
    }
    
    /* Buttons */
    .btn {
      font-size: 0.8rem !important;
      padding: 0.4rem 0.8rem !important;
    }
    
    .btn-pink {
      font-size: 0.75rem !important;
    }
    

    
    /* HR */
    hr {
      margin: 1rem 0 !important;
    }
  }
  
  /* Responsive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï (iPad) */
  @media (min-width: 769px) and (max-width: 1024px) {
    h6, .h6 {
      font-size: 0.95rem !important;
    }
    
    .nav-pills .nav-link {
      font-size: 0.85rem !important;
      padding: 0.5rem 1rem !important;
    }
    
    .card-body p,
    .card-body .small {
      font-size: 0.85rem !important;
    }
    
    .partner-card-horizontal p {
      font-size: 0.8rem !important;
    }
    
    .table {
      font-size: 0.85rem !important;
    }
    
    .btn {
      font-size: 0.9rem !important;
    }
  }

  @media (max-width: 991px) {
    .redeem-container {
      margin-top: 115px;
      margin-left: 0;
      max-width: 100%;
      padding: 1.5rem;
      justify-content: center;
      transform: translateX(-15px);
    }
  }

  @media (max-width: 768px) {
    .redeem-container {
      margin-top: 95px !important;
      margin-left: 0 !important;
      padding: 1rem !important;
      justify-content: center;
      transform: translateX(-15px);
    }

    .member-bg {
      background-size: cover;
      border-radius: 0.5rem;
      filter: brightness(1.1);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterTabsWrapper = document.querySelector('.coupon-filter-tabs-wrapper');
    
    // Top tabs (dream/partner)
    document.querySelectorAll('.coupon-top-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.coupon-top-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.getAttribute('data-target');
        document.querySelectorAll('.coupon-top-panel').forEach(p => p.classList.add('d-none'));
        document.getElementById(target).classList.remove('d-none');
        
        // Show/hide subcategory tabs based on selection
        if (target === 'tab-dream') {
          filterTabsWrapper.classList.remove('d-none');
        } else {
          filterTabsWrapper.classList.add('d-none');
        }
      });
    });

    // Filter tabs inside coupons (all / for you / used)
    document.querySelectorAll('.coupon-filter-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.coupon-filter-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const panel = btn.getAttribute('data-filter');
        document.querySelectorAll('.coupon-filter-panel').forEach(p => p.classList.add('d-none'));
        document.getElementById(panel).classList.remove('d-none');
      });
    });
    
    // Partner Modal Handler
    const partnerModal = document.getElementById('partnerModal');
    if (partnerModal) {
      partnerModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        const partnerId = button.getAttribute('data-partner-id');
        const partnerName = button.getAttribute('data-partner-name');
        const partnerTitle = button.getAttribute('data-partner-title');
        const partnerLogo = button.getAttribute('data-partner-logo');
        const partnerBranches = button.getAttribute('data-partner-branches');
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå
        document.getElementById('modalPartnerName').textContent = partnerName;
        document.getElementById('modalPartnerTitle').textContent = partnerTitle || '';
        document.getElementById('modalPartnerLogo').src = partnerLogo || '/static/img/default-partner.png';
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå
        fetch(`/account/partner/${partnerId}/coupons/`)
          .then(response => response.json())
          .then(data => {
            const branchesDiv = document.getElementById('modalBranches');
            
            if (data.coupons && data.coupons.length > 0) {
              // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
              document.getElementById('modalTotalCoupons').textContent = data.coupons.length;
              
              // ‡∏´‡∏≤‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ (‡πÅ‡∏ï‡πâ‡∏°‡∏û‡∏≠‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
              const availableCoupon = data.coupons.find(c => c.active && c.enough_points);
              
              // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
              const displayCoupon = availableCoupon || data.coupons[0];
              
              // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏Å
              document.getElementById('modalCouponPointsDisplay').textContent = displayCoupon.required_points || '0';
              
              // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏à‡∏≤‡∏Å note ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
              if (displayCoupon.note && displayCoupon.note.trim()) {
                // ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô bullet points
                const notes = displayCoupon.note.split('\n').filter(n => n.trim());
                let notesHtml = '';
                notes.forEach(note => {
                  notesHtml += `<p class="mb-1">‚Ä¢ ${note.trim()}</p>`;
                });
                branchesDiv.innerHTML = notesHtml;
              } else {
                // fallback ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå
                if (partnerBranches && partnerBranches.trim()) {
                  branchesDiv.innerHTML = `<p class="mb-1">‚Ä¢ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏Ç‡∏≤: ${partnerBranches}</p>`;
                } else {
                  branchesDiv.innerHTML = '<p class="mb-1">‚Ä¢ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</p>';
                }
              }
              
              // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì progress (‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
              const activeCount = data.coupons.filter(c => c.active).length;
              const percent = data.coupons.length > 0 ? Math.round((activeCount / data.coupons.length) * 100) : 0;
              document.getElementById('modalCouponPercent').textContent = percent;
              document.getElementById('modalCouponProgress').style.width = percent + '%';
              
              // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î
              const progressTextSpan = document.querySelector('#modalCouponProgress span');
              const percentSpan = document.querySelector('#modalCouponPercent');
              if (percent === 0) {
                progressTextSpan.classList.remove('text-white');
                progressTextSpan.classList.add('text-dark');
                percentSpan.parentElement.classList.remove('text-white');
                percentSpan.parentElement.classList.add('text-dark');
              } else {
                progressTextSpan.classList.remove('text-dark');
                progressTextSpan.classList.add('text-white');
                percentSpan.parentElement.classList.remove('text-dark');
                percentSpan.parentElement.classList.add('text-white');
              }
              
              // ‡πÅ‡∏™‡∏î‡∏á countdown ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
              if (displayCoupon.expires_at) {
                const expiryDate = new Date(displayCoupon.expires_at);
                updateCountdown(expiryDate);
                // Clear interval ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                if (window.countdownInterval) {
                  clearInterval(window.countdownInterval);
                }
                window.countdownInterval = setInterval(() => updateCountdown(expiryDate), 1000);
              }
              
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
              const btnUseCoupon = document.getElementById('btnUseCoupon');
              if (availableCoupon) {
                btnUseCoupon.disabled = false;
                btnUseCoupon.textContent = '‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•';
                btnUseCoupon.style.backgroundColor = '#ff008b';
                btnUseCoupon.style.color = 'white';
                btnUseCoupon.onclick = function() {
                  // ‡πÄ‡∏õ‡∏¥‡∏î confirmation modal
                  document.getElementById('confirmCouponId').value = availableCoupon.id;
                  document.getElementById('confirmPoints').textContent = availableCoupon.required_points;
                  
                  // ‡∏õ‡∏¥‡∏î partner modal ‡∏Å‡πà‡∏≠‡∏ô
                  const partnerModalInstance = bootstrap.Modal.getInstance(document.getElementById('partnerModal'));
                  if (partnerModalInstance) {
                    partnerModalInstance.hide();
                  }
                  
                  // ‡πÄ‡∏õ‡∏¥‡∏î confirmation modal
                  const confirmModal = new bootstrap.Modal(document.getElementById('confirmRedeemModal'));
                  confirmModal.show();
                };
              } else {
                btnUseCoupon.disabled = true;
                btnUseCoupon.style.backgroundColor = '#6c757d';
                btnUseCoupon.style.color = 'white';
                if (data.coupons.some(c => c.active && !c.enough_points)) {
                  btnUseCoupon.textContent = '‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏û‡∏≠';
                } else if (data.coupons.every(c => !c.active)) {
                  btnUseCoupon.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                } else {
                  btnUseCoupon.textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ';
                }
              }
            } else {
              document.getElementById('modalTotalCoupons').textContent = '0';
              document.getElementById('modalCouponPercent').textContent = '0';
              document.getElementById('modalCouponProgress').style.width = '0%';
              branchesDiv.innerHTML = '<p class="mb-1 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
              
              // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
              const progressTextSpan = document.querySelector('#modalCouponProgress span');
              const percentSpan = document.querySelector('#modalCouponPercent');
              if (progressTextSpan) {
                progressTextSpan.classList.remove('text-white');
                progressTextSpan.classList.add('text-dark');
              }
              if (percentSpan && percentSpan.parentElement) {
                percentSpan.parentElement.classList.remove('text-white');
                percentSpan.parentElement.classList.add('text-dark');
              }
              
              const btnUseCoupon = document.getElementById('btnUseCoupon');
              btnUseCoupon.disabled = true;
              btnUseCoupon.style.backgroundColor = '#6c757d';
              btnUseCoupon.style.color = 'white';
              btnUseCoupon.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ';
            }
          })
          .catch(error => {
            console.error('Error loading coupons:', error);
            const btnUseCoupon = document.getElementById('btnUseCoupon');
            btnUseCoupon.disabled = true;
            btnUseCoupon.style.backgroundColor = '#6c757d';
            btnUseCoupon.style.color = 'white';
            btnUseCoupon.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          });
      });
    }
    
    function updateCountdown(targetDate) {
      const now = new Date();
      const diff = targetDate - now;
      
      if (diff <= 0) {
        document.getElementById('expiryDays').textContent = '0';
        document.getElementById('expiryHours').textContent = '0';
        document.getElementById('expiryMinutes').textContent = '0';
        document.getElementById('expirySeconds').textContent = '0';
        return;
      }
      
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      document.getElementById('expiryDays').textContent = days.toString().padStart(2, '0');
      document.getElementById('expiryHours').textContent = hours.toString().padStart(2, '0');
      document.getElementById('expiryMinutes').textContent = minutes.toString().padStart(2, '0');
      document.getElementById('expirySeconds').textContent = seconds.toString().padStart(2, '0');
    }
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå
    function loadPartnerExpiry() {
      document.querySelectorAll('.partner-card-horizontal').forEach(card => {
        const partnerId = card.getAttribute('data-partner-id');
        if (!partnerId) return;
        
        fetch(`/account/partner/${partnerId}/coupons/`)
          .then(response => response.json())
          .then(data => {
            if (data.coupons && data.coupons.length > 0) {
              // ‡∏´‡∏≤‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
              let nearestExpiry = null;
              data.coupons.forEach(coupon => {
                if (coupon.expires_at) {
                  const expiryDate = new Date(coupon.expires_at);
                  if (!nearestExpiry || expiryDate < nearestExpiry) {
                    nearestExpiry = expiryDate;
                  }
                }
              });
              
              // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 28 ‡∏û.‡∏¢ 2568
              const expirySpan = document.querySelector(`.partner-expiry-${partnerId}`);
              if (expirySpan && nearestExpiry) {
                const thaiMonths = ['‡∏°.‡∏Ñ', '‡∏Å.‡∏û', '‡∏°‡∏µ.‡∏Ñ', '‡πÄ‡∏°.‡∏¢', '‡∏û.‡∏Ñ', '‡∏°‡∏¥.‡∏¢', '‡∏Å.‡∏Ñ', '‡∏™.‡∏Ñ', '‡∏Å.‡∏¢', '‡∏ï.‡∏Ñ', '‡∏û.‡∏¢', '‡∏ò.‡∏Ñ'];
                const day = nearestExpiry.getDate();
                const month = thaiMonths[nearestExpiry.getMonth()];
                const year = nearestExpiry.getFullYear() + 543; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û.‡∏®.
                expirySpan.textContent = `${day} ${month} ${year}`;
              }
              
              // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
              const couponCountSpan = document.querySelector(`.partner-coupon-count-${partnerId}`);
              if (couponCountSpan) {
                // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
                const couponCount = data.coupons.length;
                // ‡∏´‡∏≤‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                let minPoints = null;
                data.coupons.forEach(coupon => {
                  if (coupon.required_points !== undefined && coupon.required_points !== null) {
                    if (minPoints === null || coupon.required_points < minPoints) {
                      minPoints = coupon.required_points;
                    }
                  }
                });
                
                if (minPoints !== null) {
                  couponCountSpan.textContent = `${minPoints} ‡∏û‡∏≠‡∏¢‡∏ó‡πå`;
                } else {
                  couponCountSpan.textContent = `${couponCount} ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á`;
                }
              }
            } else {
              // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á ‡πÅ‡∏™‡∏î‡∏á "‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î" ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏î
              const expirySpan = document.querySelector(`.partner-expiry-${partnerId}`);
              if (expirySpan) {
                expirySpan.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î';
              }
              
              const couponCountSpan = document.querySelector(`.partner-coupon-count-${partnerId}`);
              if (couponCountSpan) {
                couponCountSpan.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î';
              }
              
              // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πÑ‡∏ï‡∏•‡πå
              card.removeAttribute('data-bs-toggle');
              card.removeAttribute('data-bs-target');
              card.style.cursor = 'not-allowed';
              card.style.opacity = '0.6';
            }
          })
          .catch(error => {
            console.error(`Error loading expiry for partner ${partnerId}:`, error);
            // ‡∏Å‡∏£‡∏ì‡∏µ error ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á "‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î" ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏î
            const expirySpan = document.querySelector(`.partner-expiry-${partnerId}`);
            if (expirySpan) {
              expirySpan.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î';
            }
            
            const couponCountSpan = document.querySelector(`.partner-coupon-count-${partnerId}`);
            if (couponCountSpan) {
              couponCountSpan.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î';
            }
            
            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πÑ‡∏ï‡∏•‡πå
            card.removeAttribute('data-bs-toggle');
            card.removeAttribute('data-bs-target');
            card.style.cursor = 'not-allowed';
            card.style.opacity = '0.6';
          });
      });
    }
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    loadPartnerExpiry();
    
    // ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö
    document.querySelectorAll('.coupon-top-tab, .coupon-filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        setTimeout(() => loadPartnerExpiry(), 100);
      });
    });
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
    const myCouponModal = document.getElementById('myCouponModal');
    if (myCouponModal) {
      myCouponModal.addEventListener('show.bs.modal', function(event) {
        const card = event.relatedTarget;
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å data attributes
        const partnerName = card.getAttribute('data-coupon-partner');
        const couponName = card.getAttribute('data-coupon-name');
        const couponCode = card.getAttribute('data-coupon-code');
        const branches = card.getAttribute('data-coupon-branches');
        const endsAt = card.getAttribute('data-coupon-ends');
        const redeemedAt = card.getAttribute('data-redemption-created');
        const imageCodeUrl = card.getAttribute('data-image-code');
        const couponNote = card.getAttribute('data-coupon-note');
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Modal
        document.getElementById('myCouponPartnerName').textContent = partnerName || '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á';
        document.getElementById('myCouponName').textContent = couponName || '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î';
        document.getElementById('myCouponCode').textContent = couponCode;
        document.getElementById('myCouponBranches').textContent = branches || '‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤';
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
        if (couponNote) {
          document.getElementById('myCouponPoints').textContent = couponNote;
        } else {
          document.getElementById('myCouponPoints').textContent = '-';
        }
        
        // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å
        if (redeemedAt) {
          const redeemedDate = new Date(redeemedAt);
          const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
          const day = redeemedDate.getDate();
          const month = thaiMonths[redeemedDate.getMonth()];
          const year = redeemedDate.getFullYear() + 543;
          const hours = redeemedDate.getHours().toString().padStart(2, '0');
          const minutes = redeemedDate.getMinutes().toString().padStart(2, '0');
          document.getElementById('myCouponRedeemed').textContent = `${day} ${month} ${year} ‡πÄ‡∏ß‡∏•‡∏≤ ${hours}:${minutes} ‡∏ô.`;
        }
        
        // ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        if (endsAt) {
          const expiryDate = new Date(endsAt);
          const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
          const day = expiryDate.getDate();
          const month = thaiMonths[expiryDate.getMonth()];
          const year = expiryDate.getFullYear() + 543;
          const hours = expiryDate.getHours().toString().padStart(2, '0');
          const minutes = expiryDate.getMinutes().toString().padStart(2, '0');
          document.getElementById('myCouponExpiry').textContent = `${day} ${month} ${year} ‡πÄ‡∏ß‡∏•‡∏≤ ${hours}:${minutes} ‡∏ô.`;
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á QR Code
        const qrImg = document.getElementById('myCouponQR');
        if (imageCodeUrl) {
          qrImg.src = imageCodeUrl;
          qrImg.style.display = 'block';
        } else {
          qrImg.style.display = 'none';
        }
      });
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
    window.copyCouponCode = function() {
      const code = document.getElementById('myCouponCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ' + code);
      });
    };
    
    // Auto-play carousel for coupon slides
    const couponCarousel = document.getElementById('couponSlideCarouselRedeem');
    if (couponCarousel) {
      const bsCarousel = new bootstrap.Carousel(couponCarousel, {
        interval: 5000,  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        wrap: true,      // ‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        touch: true      // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ swipe ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
      });
    }
  });
  
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î popup ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Coupon Slide
  function showPartnerPopupRedeem(partnerId) {
    if (!partnerId) return;
    
    fetch(`/account/partner/${partnerId}/coupons/`)
      .then(response => response.json())
      .then(data => {
        if (data.coupons && data.coupons.length > 0) {
          const availableCoupon = data.coupons.find(c => c.active && c.enough_points);
          const displayCoupon = availableCoupon || data.coupons[0];
          showCouponModalRedeem(data, displayCoupon);
        } else {
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ');
        }
      })
      .catch(error => {
        console.error('Error loading partner coupons:', error);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      });
  }

  function showCouponModalRedeem(data, displayCoupon) {
    let modal = document.getElementById('partnerCouponModalRedeem');
    if (!modal) {
      const modalHTML = `
        <div class="modal fade" id="partnerCouponModalRedeem" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content border-0 shadow-lg rounded-4">
              <div class="modal-body p-0">
                <div class="position-relative">
                  <img id="modalCouponImageRedeem" src="" alt="Coupon QR" class="w-100" style="max-height:180px;object-fit:contain;background-color:#f8f9fa; display:none;">
                  <button type="button" class="btn-close position-absolute top-0 end-0 m-3 bg-white rounded-circle p-2" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="p-2">
                  <h5 class="text-center mb-3">
                    ‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏¢‡∏ó‡πå‡πÅ‡∏•‡∏Å <span id="modalCouponPointsDisplayRedeem" style="color: #ff008b; font-weight: bold;">0</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                  </h5>
                  <span id="modalPartnerNameRedeem" style="display:none;"></span>
                  
                  <div class="bg-light rounded-3 p-1 mb-1">
                    <h6 class="text-muted mb-2"><i class="fa fa-clock me-2"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</h6>
                    <div id="modalCouponExpiryRedeem" class="d-flex justify-content-center gap-3">
                      <div class="text-center">
                        <div class="fw-bold fs-4" id="expiryDaysRedeem">--</div>
                        <small class="text-muted">‡∏ß‡∏±‡∏ô</small>
                      </div>
                      <div class="text-center">
                        <div class="fw-bold fs-4" id="expiryHoursRedeem">--</div>
                        <small class="text-muted">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</small>
                      </div>
                      <div class="text-center">
                        <div class="fw-bold fs-4" id="expiryMinutesRedeem">--</div>
                        <small class="text-muted">‡∏ô‡∏≤‡∏ó‡∏µ</small>
                      </div>
                      <div class="text-center">
                        <div class="fw-bold fs-4" id="expirySecondsRedeem">--</div>
                        <small class="text-muted">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</small>
                      </div>
                    </div>
                  </div>
                  
                  <div class="border rounded-3 p-1 mb-3">
                    <div class="text-center mb-1">
                      <small class="text-muted">‡πÅ‡∏à‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong id="modalTotalCouponsRedeem">0</strong> ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏•‡∏≠‡∏î‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ô</small>
                    </div>
                    <div class="progress position-relative" style="height:35px; border-radius:20px; background-color:#d3d3d3;">
                      <div class="progress-bar d-flex align-items-center justify-content-center fw-bold" 
                           id="modalCouponProgressRedeem" 
                           style="width:0%; background-color:#ff008b; border-radius:20px;">
                        <span class="text-white">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                      </div>
                      <div class="position-absolute top-50 end-0 translate-middle-y me-3">
                        <small class="text-white fw-bold"><span id="modalCouponPercentRedeem">0</span>%</small>
                      </div>
                    </div>
                  </div>
                  
                  <div class="mb-4">
                    <h6 class="fw-semibold mb-2"><i class="fa fa-info-circle me-2"></i>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</h6>
                    <div class="small text-muted">
                      <p class="mb-1"><strong>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:</strong> <span id="modalCouponBranchesRedeem"></span></p>
                      <p class="mb-0"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> <span id="modalCouponNoteRedeem"></span></p>
                      <span id="modalCouponCodeRedeem" style="display:none;"></span>
                      <span id="modalCouponPointsRedeem" style="display:none;"></span>
                      <span id="modalUserPointsRedeem" style="display:none;">{{ meter.points|default:0 }}</span>
                      <span id="modalPointsStatusRedeem" style="display:none;"></span>
                    </div>
                  </div>
                  
                  <form method="post" id="modalRedeemFormRedeem">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="redeem">
                    <input type="hidden" name="coupon_id" id="modalRedeemCouponIdRedeem">
                    
                    <button type="submit" class="btn w-100 fw-semibold py-3 rounded-3" id="modalRedeemBtnRedeem" style="background-color: #ff008b; color: white; border: none;">
                      ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      modal = document.getElementById('partnerCouponModalRedeem');
    }
    
    document.getElementById('modalPartnerNameRedeem').textContent = data.partner_name || '‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå';
    document.getElementById('modalCouponCodeRedeem').textContent = displayCoupon.code || '-';
    document.getElementById('modalCouponPointsRedeem').textContent = displayCoupon.required_points || '0';
    document.getElementById('modalCouponPointsDisplayRedeem').textContent = displayCoupon.required_points || '0';
    document.getElementById('modalCouponNoteRedeem').textContent = displayCoupon.note || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏';
    document.getElementById('modalCouponBranchesRedeem').textContent = displayCoupon.available_branches || '‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤';
    document.getElementById('modalRedeemCouponIdRedeem').value = displayCoupon.id;
    
    const imgElement = document.getElementById('modalCouponImageRedeem');
    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ QR Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
    if (data.partner && data.partner.slide_image_url) {
      imgElement.src = data.partner.slide_image_url;
      imgElement.style.display = 'block';
    } else if (displayCoupon.image_code_url) {
      imgElement.src = displayCoupon.image_code_url;
      imgElement.style.display = 'block';
    } else {
      imgElement.style.display = 'none';
    }
    
    const activeCount = data.coupons.filter(c => c.active).length;
    const totalCount = data.coupons.length;
    const percent = totalCount > 0 ? Math.round((activeCount / totalCount) * 100) : 0;
    
    document.getElementById('modalTotalCouponsRedeem').textContent = totalCount;
    document.getElementById('modalCouponProgressRedeem').style.width = percent + '%';
    document.getElementById('modalCouponPercentRedeem').textContent = percent;
    
    // ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
    if (displayCoupon.expires_at) {
      const expiryDate = new Date(displayCoupon.expires_at);
      
      function updateCountdownRedeem() {
        const now = new Date();
        const diff = expiryDate - now;
        
        if (diff <= 0) {
          document.getElementById('expiryDaysRedeem').textContent = '0';
          document.getElementById('expiryHoursRedeem').textContent = '0';
          document.getElementById('expiryMinutesRedeem').textContent = '0';
          document.getElementById('expirySecondsRedeem').textContent = '0';
          return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('expiryDaysRedeem').textContent = days;
        document.getElementById('expiryHoursRedeem').textContent = hours;
        document.getElementById('expiryMinutesRedeem').textContent = minutes;
        document.getElementById('expirySecondsRedeem').textContent = seconds;
      }
      
      updateCountdownRedeem();
      const countdownInterval = setInterval(updateCountdownRedeem, 1000);
      
      // Clear interval ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î modal
      modal.addEventListener('hidden.bs.modal', function() {
        clearInterval(countdownInterval);
      }, { once: true });
    } else {
      document.getElementById('expiryDaysRedeem').textContent = '‚àû';
      document.getElementById('expiryHoursRedeem').textContent = '‚àû';
      document.getElementById('expiryMinutesRedeem').textContent = '‚àû';
      document.getElementById('expirySecondsRedeem').textContent = '‚àû';
    }
    
    const userPoints = {{ meter.points|default:0 }};
    const requiredPoints = displayCoupon.required_points || 0;
    const enoughPoints = userPoints >= requiredPoints;
    const isActive = displayCoupon.active;
    
    const redeemBtn = document.getElementById('modalRedeemBtnRedeem');
    
    if (!isActive) {
      redeemBtn.disabled = true;
      redeemBtn.textContent = '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß';
      redeemBtn.style.backgroundColor = '#6c757d';
      redeemBtn.style.color = 'white';
    } else if (!enoughPoints) {
      redeemBtn.disabled = true;
      redeemBtn.textContent = '‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠';
      redeemBtn.style.backgroundColor = '#6c757d';
      redeemBtn.style.color = 'white';
    } else {
      redeemBtn.disabled = false;
      redeemBtn.textContent = '‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•';
      redeemBtn.style.backgroundColor = '#ff008b';
      redeemBtn.style.color = 'white';
    }
    
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
  }
  </script>
  
  <style>
  .coupon-slide-clickable {
    transition: opacity 0.2s, transform 0.2s;
  }
  .coupon-slide-clickable:hover {
    opacity: 0.85;
    transform: scale(1.02);
  }
  </style>

{% endblock %}
