{% extends 'base/base.html' %}
{% block title %}DDreamclinic{% endblock %}
{% load static %} 
{% block content %}

{% comment %} <!-- ‚úÖ Container ‡∏´‡∏•‡∏±‡∏Å --> {% endcomment %}
<div class="container py-3 redeem-container">
  {% comment %}
  <!-- üå∏ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
  <div
    class="text-center text-white py-4 rounded-4 mb-4"
    style="
      background: linear-gradient(135deg, #ff008b, #ff66c8);
      box-shadow: 0 4px 10px rgba(255, 0, 139, 0.2);
    "
  >
    <h4 class="fw-bold mb-0"><i class="fa fa-gift me-2"></i> ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h4>
  </div>

  <!-- üåà ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <div class="member-section p-3 mb-4 rounded-4">
    <div class="fw-semibold mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}</div>
    <div class="mb-3">
      ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts
    </div>
    <div class="progress" style="max-width: 320px; height: 10px">
      <div class="progress-bar" style="width: {{ meter.progress_pct }}%;"></div>
    </div>
    <small class="d-block mt-2">
      {% if meter.next_level_name %} ‡∏≠‡∏µ‡∏Å {{ meter.remain_to_next }} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô {{ meter.next_level_name }} {% else %} ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß {%
      endif %}
    </small>
  </div>
  {% endcomment %}
  <div class="card border-0 shadow-sm overflow-hidden position-relative member-bg">
    <div class="overlay position-absolute top-0 start-0 w-100 h-100"></div>
    <div class="card-body d-flex flex-column flex-md-row align-items-start justify-content-between position-relative member-content" >

      <div class="d-flex flex-column align-items-start gap-3 member-left">
        <div class="member-info d-flex align-items-center flex-wrap">
          <span class="badge rounded-pill shadow-sm fw-bold member-badge d-flex align-items-center gap-2" >
            {% if meter.level == "Silver" %}
            <i class="fa fa-medal level-icon text-silver"></i>
            {% elif meter.level == "Gold" %}
            <i class="fa fa-medal level-icon text-gold"></i>
            {% else %}
            <i class="fa fa-crown level-icon text-premium"></i>
            {% endif %} ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}
          </span>
        </div>
        <p class=" mb-0 member-points"> ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts </p>

        <div class="progress-wrapper w-100" style="max-width: 200px">
          <div class="d-flex justify-content-between small mb-1 member-progress-text" >
            <span>{{ meter.level }}</span>
            <span>{{ meter.progress_pct }}%</span>
          </div>
          <div class="progress bg-light bg-opacity-50 member-progress-bar">
            <div class="progress-bar member-progress" style="width: {{ meter.progress_pct }}%" >
            </div>
          </div>
          <div class="small fw-semibold member-progress-text">
            {% if meter.next_level_name %} ‡∏≠‡∏µ‡∏Å
            <strong>{{ meter.remain_to_next }}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô
            <strong>{{ meter.next_level_name }}</strong>
            {% else %} ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr>
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
  </h6>
</div>
  <hr>
  {% comment %} <!-- üéüÔ∏è ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
  </h6>
</div>
  <div class="row g-3 mb-4">
    {% for r in my_coupons %} {% with c=r.coupon %}
    <div class="col-6 col-md-4 col-lg-3">
      <div class="card coupon-card border-0 shadow-sm h-100 rounded-4 overflow-hidden" >
        {% if c.image_code and c.image_code.name %}
        <img src="{{ c.image_code.url }}" class="card-img-top" alt="{{ c.code }}" />
        {% else %} {% include "account/coupon_fall.html" with c=c theme="cpn--light" %} {% endif %}
        
        <div class="card-body d-flex flex-column p-2">
          <div class="input-group input-group-sm mt-auto">
            <input type="text" class="form-control" value="{{ c.code }}" readonly />
            <button type="button" class="btn btn-pink" onclick="navigator.clipboard.writeText('{{ c.code }}')">
              ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endwith %} {% empty %}
    <div class="col-12 text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏ß‡πâ</div>
    {% endfor %}
  </div>
  <hr />
  {% comment %} <!-- üéÅ ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ
  </h6>
</div>
  <div class="row g-3 mb-4">
    {% for c in available %}
    <div class="col-6 col-md-4 col-lg-3">
      <div class="card coupon-card border-0 shadow-sm h-100 rounded-4 overflow-hidden">
        {% if c.image and c.image_code %}
        <img src="{{ c.image.url }}" class="card-img-top" alt="{{ c.code }}"/>
        {% elif c.active %} {% include "account/coupon_fall.html" with c=c
        theme="cpn--teal" %} {% else %} {% include "account/coupon_fall.html"
        with c=c theme="cpn--light" %} {% endif %}

        <div class="card-body d-flex flex-column p-2">
          <div class="small text-muted mb-1"> ‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <strong>{{ c.req_pts }}</strong>
          </div>

          <br />

          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="redeem" />
            <input type="hidden" name="coupon_id" value="{{ c.id }}" />
            <button class="btn btn-pink btn-sm fw-semibold"
              {% if not c.can_use or not c.enough_points %} disabled{% endif %}>‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
            </button>
          </form>
          {% if not c.active %}
          <div class="form-text text-danger small">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</div>
          {% elif not c.enough_points %}
          <div class="form-text text-warning small">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12 text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏Å</div>
    {% endfor %}
  </div>

  <hr>
  
  {% comment %} <!--  ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å --> {% endcomment %}
  <div class="text-center text-white rounded-4">
  <h6 class="fw-normal text-pink mb-3">
    <i class="fa fa-gift me-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å
  </h6>
</div>
  <div class="table-responsive">
    <table class="table table-hover align-middle text-center">
      <thead class="table-pink">
        <tr>
          <th>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</th>
          <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
          {% comment %} <th>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th> {% endcomment %}
        </tr>
      </thead>
      <tbody>
        {% for r in redemptions %}
        <tr>
          <td class="text-start">
            {% if r.coupon.image %}
            <img
              src="{{ r.coupon.image.url }}"
              class="me-2 rounded"
              style="width: 36px; height: auto"
            />
            {% endif %} {{ r.coupon.code }}
          </td>
          <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
          {% comment %} <td>{{ r.order_id|default:"-" }}</td> {% endcomment %}
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<style>
  body {
    background-color: #f8f9fa;
  }

  .redeem-container {
    margin-top: 120px;
    margin-left: 120px;
    max-width: calc(100% - 240px);
    padding: 2rem;
    transition: all 0.3s ease;
  }

  hr {
    border: none;
    border-top: 2px solid #ff008b;
    margin: 1.5rem 0;
    opacity: 0.5;
  }

  .btn-pink {
    background-color: #ff008b !important;
    color: #fff !important;
    border-radius: 5px;
    border: none;
    transition: 0.3s;
  }

  .btn-pink:hover {
    background-color: #ff66c8 !important;
    box-shadow: 0 4px 10px rgba(255, 102, 200, 0.3);
  }

  .member-bg {
    aspect-ratio: 2 / 1;
    width: 100%;
    border-radius: 0.75rem;
    background-image: url("/media/gardDM.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
    color: white;
    overflow: hidden;
    transition: all 0.3s ease;
    filter: brightness(1.1);
    box-shadow: 0 4px 15px rgba(255, 0, 139, 0.15);
  }

  .member-bg .overlay {
    background: rgba(0, 0, 0, 0.08);
    z-index: 1;
  }

  .member-content {
    z-index: 2;
    padding: clamp(1rem, 3vw, 2.5rem);
  }

  .member-badge {
    font-size: 1.25rem !important;
    padding: 0.75rem 1.5rem !important;
    border-radius: 2rem !important;
  }

  .level-icon {
    font-size: 1.5rem !important;
  }

  .member-points {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .member-bg .member-points,
  .member-bg .member-progress-text,
  .member-bg .member-badge,
  .member-bg strong,
  .member-bg span,
  .member-bg p,
  .member-bg h6,
  .member-bg h5 {
    color: #b8860b !important;
    text-shadow: 0 1px 2px rgba(200, 213, 8, 0.15);
  }

  .progress {
    border-radius: 8px;
    height: 8px;
  }

  .member-progress {
    background: linear-gradient(90deg, #ff008b, #ff66c8);
    border-radius: 8px;
  }

  .text-silver {
    color: #c0c0c0;
  }

  .text-gold {
    color: #ffd700;
  }

  .text-premium {
    color: #ff66c8;
  }

  
  @media (max-width: 768px) {
    .member-badge {
      font-size: 0.7rem !important;
      padding: 0.25rem 0.5rem !important;
      border-radius: 1rem !important;
    }

    .member-points {
      font-size: 0.7rem !important;
      max-width: 100%;
    }

    .level-icon {
      font-size: 0.75rem !important;
    }

    /* üîπ ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏•‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö */
    .member-bg .member-content {
      font-size: 0.5rem !important;
      padding: 0.6rem 0.8rem !important;
      line-height: 1.2 !important;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    /* üîπ ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î */
    .member-bg strong,
    .member-bg span,
    .member-bg small,
    .member-bg .member-progress-text {
      font-size: 0.6rem !important;
      line-height: 1.2 !important;
    }

    /* üîπ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏•‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö */
    .member-points {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* üîπ ‡∏õ‡∏£‡∏±‡∏ö progress bar ‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏•‡πá‡∏Å */
    .member-bg .progress {
      height: 5px !important;
      border-radius: 5px !important;
    }

    /* üîπ ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    .redemption-table th,
    .redemption-table td {
      font-size: 05rem !important;
      padding: 0.2rem 0.3rem !important;
      line-height: 1.2;
      word-wrap: break-word;
    }

    .redemption-table img {
      width: 24px !important;
      height: auto !important;
    }

    .redemption-table th {
      font-size: 0.75rem !important;
      font-weight: 600;
    }
  }

  @media (max-width: 991px) {
    .redeem-container {
      margin-top: 115px;
      margin-left: 0;
      max-width: 100%;
      padding: 1.5rem;
      justify-content: center;
      transform: translateX(-15px);
    }
  }

  @media (max-width: 768px) {
    .redeem-container {
      margin-top: 95px !important;
      margin-left: 0 !important;
      padding: 1rem !important;
      justify-content: center;
      transform: translateX(-15px);
    }

    .member-bg {
      background-size: cover;
      border-radius: 0.5rem;
      filter: brightness(1.1);
    }
  }
</style>



{% endblock %}
