{% extends 'base/base.html' %} 
{% load static %}
{% block title %}DDreamclinic{% endblock %}
{% url 'promotion_detail' pk=p.id %}

{% block content %}
<div class="container dashboard-container">

  {% comment %} <!--  ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --> {% endcomment %}
  <div class="card border-0 shadow-sm overflow-hidden position-relative member-bg">
    <div class="overlay position-absolute top-0 start-0 w-100 h-100"></div>

    <div class="card-body d-flex flex-column flex-md-row align-items-start justify-content-between position-relative member-content">
      
      <div class="d-flex flex-column align-items-start gap-3 member-left">
        
        <div class="member-info d-flex align-items-center flex-wrap">
          <span class="badge rounded-pill shadow-sm fw-bold member-badge d-flex align-items-center gap-1">
            {% if meter.level == "Silver" %}
              <i class="fa fa-medal level-icon text-silver"></i>
            {% elif meter.level == "Gold" %}
              <i class="fa fa-medal level-icon text-gold"></i>
            {% else %}
              <i class="fa fa-crown level-icon text-premium"></i>
            {% endif %}
            ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}
          </span>
        </div>

        <p class=" mb-0 member-points">
          ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts
        </p>

        <div class="progress-wrapper w-100" style="max-width: 200px;">
          <div class="d-flex justify-content-between small mb-1 member-progress-text">
            <span>{{ meter.level }}</span>
            <span>{{ meter.progress_pct }}%</span>
          </div>
          <div class="progress bg-light bg-opacity-50 member-progress-bar">
            <div class="progress-bar member-progress" style="width: {{ meter.progress_pct }}%;"></div>
          </div>
          <div class="small mt-2 fw-semibold member-progress-text">
            {% if meter.next_level_name %}
              ‡∏≠‡∏µ‡∏Å <strong>{{ meter.remain_to_next }}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô <strong>{{ meter.next_level_name }}</strong>
            {% else %}
              ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß 
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  {% comment %} <div class="text-center text-white rounded-4">
    <h6 class="fw-normal text-pink mb-3">
      <i class="fa me-2"></i> D'DREAM CLINIC
    </h6>
  </div>

  <div class="text-center">
    <tr>
      <td colspan="3" class="text-muted">D'Dream ‡∏î‡∏µ‡∏î‡∏£‡∏µ‡∏°‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏° ‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤
       ‡∏î‡∏π‡πÅ‡∏• ‡πÅ‡∏•‡∏∞‡∏â‡∏µ‡∏î‡πÇ‡∏î‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏™ ‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏° ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏¥‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏¢
        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á ‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
        ‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å
         ‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ‡∏ú‡πà‡∏≤‡∏ô ‡∏≠‡∏¢. ‡πÑ‡∏ó‡∏¢ ‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</td>
      </tr>
  </div> {% endcomment %}
</div>
<hr>
{% comment %} <!--  ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
<div class="promotion-section mt-5 position-relative">
  <h5 class="fw-bold text-pink mb-3">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h5>

  <div class="promo-slider-wrapper position-relative overflow-hidden">
    <div class="promo-slider d-flex gap-3">
      {% for p in promotions %}
      {% if p.is_active_now %}
      <div class="promo-card card shadow-sm border-0">
        <div class="ratio ratio-16x9 position-relative">
          {% if p.cover_image %}
          <img src="{{ p.cover_image.url }}" class="card-img-top" alt="{{ p.title }}">
          {% else %}
          <img src="{% static 'img/promo-placeholder.webp' %}" class="card-img-top" alt="Promotion">
          {% endif %}
        </div>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title fw-bold text-pink">{{ p.title }}</h6>
          {% if p.short_text %}
          <p class="text-muted small clamp-2">{{ p.short_text }}</p>
          {% endif %}
          <div class="mt-auto">
            <button class="btn btn-pink btn-sm w-100"
              data-bs-toggle="modal"
              data-bs-target="#promotionDetailModal-{{ p.id }}">
              ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            </button>
          </div>
        </div>
      </div>
      {% include "account/promotion_detail_modal.html" with p=p %}
      {% endif %}
      {% endfor %}
    </div>

    <!--  ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ -->
    <button class="btn-slide promo-prev" id="promo-prev">
      <i class="bi bi-arrow-left-circle-fill"></i>
    </button>
    <button class="btn-slide promo-next" id="promo-next">
      <i class="bi bi-arrow-right-circle-fill"></i>
    </button>
  </div>
</div>

<!--  CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
<style>
  /*  ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Home */
  body {
    background-color: #fff0f6 !important; /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡πâ‡∏≤ home */
    overflow-x: hidden;
  }

  .text-pink { color: #e91e63 !important; }
  .btn-pink {
    background-color: #e91e63;
    color: white;
    border: none;
    border-radius: 0.5rem;
  }
  .btn-pink:hover { background-color: #d81b60; }

  .promotion-section {
    max-width: 950px;
    margin: 2rem auto;
  }

  .promo-slider-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .promo-slider {
    display: flex;
    transition: transform 0.4s ease;
  }

  .promo-card {
    flex: 0 0 calc(33.333% - 1rem);
    min-width: 280px;
    max-width: 320px;
    border-radius: 1rem;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .promo-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 18px rgba(233, 30, 99, 0.2);
  }

  .btn-slide {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #e91e63;
    font-size: 3rem;
    cursor: pointer;
    z-index: 10;
    transition: all 0.25s ease;
    text-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
  }
  .btn-slide:hover {
    color: #ff66a3;
    transform: translateY(-50%) scale(1.1);
  }
  .promo-prev { left: -50px; }
  .promo-next { right: -50px; }

  .clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (max-width: 767px) {
    .promo-slider {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      transform: none !important;
    }
    .promo-card {
      width: 100%;
      min-width: auto;
      max-width: none;
    }
    .btn-slide {
      display: none !important;
    }
  }
</style>

<!--  JavaScript slide -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const slider = document.querySelector(".promo-slider");
    const cards = document.querySelectorAll(".promo-card");
    const prevBtn = document.getElementById("promo-prev");
    const nextBtn = document.getElementById("promo-next");

    if (!slider || !cards.length) return;

    let currentIndex = 0;
    let cardWidth = cards[0].offsetWidth + 24;
    const cardsPerView = 3;

    function updateSlider() {
      if (window.innerWidth > 767) {
        slider.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
      } else {
        slider.style.transform = "none";
      }
    }

    nextBtn?.addEventListener("click", () => {
      if (currentIndex < cards.length - cardsPerView) {
        currentIndex++;
        updateSlider();
      }
    });

    prevBtn?.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateSlider();
      }
    });

    window.addEventListener("resize", () => {
      cardWidth = cards[0].offsetWidth + 24;
      updateSlider();
    });
  });
</script> {% endcomment %}

{% comment %} <!--  CSS ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ Dashboard --> {% endcomment %}
<style>
  .dashboard-container {
    margin-top: 120px;
    margin-left: auto;
    margin-right: auto;
    padding: 1.5rem;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    max-width: 950px;
  }

  .member-bg {
    aspect-ratio: 2 / 1;
    width: 100%;
    border-radius: 0.75rem; 
    background-image: url('/media/gardDM.png');
    background-size: cover; 
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
    color: white;
    overflow: hidden;
    transition: all 0.3s ease;
    filter: brightness(1.1);
    box-shadow: 0 4px 15px rgba(255, 0, 139, 0.15);
  }

  .member-bg .overlay {
    background: rgba(0, 0, 0, 0.08);
    z-index: 1;
  }

  hr {
    border: none;
    border-top: 2px solid #ff008b;
    margin: 1.5rem 0;
    opacity: 0.5;
  }

  .member-content {
    z-index: 2;
    padding: clamp(1rem, 3vw, 2.5rem);
  }

  .member-badge {
    font-size: 1.25rem !important;
    padding: 0.75rem 1.5rem !important;
    border-radius: 2rem !important;
  }

  .level-icon {
    font-size: 1.5rem !important;
  }

  .member-points {
    font-size: 1.2rem !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .member-bg .member-points,
  .member-bg .member-progress-text,
  .member-bg .member-badge,
  .member-bg strong,
  .member-bg span,
  .member-bg p,
  .member-bg h6,
  .member-bg h5 {
    color: #b8860b !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
  }

  .progress {
    border-radius: 8px;
    height: 8px;
  }

  .member-progress {
    background: linear-gradient(90deg, #ff008b, #ff66c8);
    border-radius: 8px;
  }

  {% comment %} /* üéñÔ∏è ‡∏™‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö */ {% endcomment %}
  .text-silver { color: #c0c0c0; }
  .text-gold { color: #ffd700; }
  .text-premium { color: #ff66c8; }

  {% comment %} /* ‚úÖ Responsive: Tablet */ {% endcomment %}
  @media (max-width: 991px) {
    .dashboard-container {
      margin-top: 110px;
      justify-content: center;
      padding: 1.5rem;
    }
  }

  {% comment %} /* ‚úÖ Responsive: Mobile (‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Redeem) */ {% endcomment %}
  @media (max-width: 768px) {
    .dashboard-container {
      margin-top: 95px;
      padding: 1rem;
      justify-content: center;
      transform: translateX(-15px);
    }

    .member-bg {
      background-size: cover;
      border-radius: 0.5rem; 
      filter: brightness(1.1);
    }

    .member-badge {
      font-size: 0.6rem !important;
      padding: 0.25rem 0.5rem !important;
      border-radius: 1rem !important;
    }

    .level-icon {
      font-size: 0.75rem !important;
    }

    .member-points {
      font-size: 0.6rem !important;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    {% comment %} /* üîπ ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏•‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö */ {% endcomment %}
    .member-bg .member-content {
      font-size: 0.4rem !important;
      padding: 0.6rem 0.8rem !important;
      line-height: 1.2 !important;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    {% comment %} /* üîπ ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */ {% endcomment %}
    .member-bg strong,
    .member-bg span,
    .member-bg small,
    .member-bg .member-progress-text {
      font-size: 0.55rem !important;
      line-height: 1.2 !important;
    }

    {% comment %} /* üîπ ‡∏õ‡∏£‡∏±‡∏ö progress bar ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å */ {% endcomment %}
    .member-bg .progress {
      height: 5px !important;
      border-radius: 5px !important;
    }
  }
</style>


{% endblock %}
