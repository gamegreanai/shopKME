{% extends 'base/base.html' %}
{% load static %}
{% block title %}‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà | shopKME{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- üîπ ‡πÅ‡∏ñ‡∏ö Points & Level -->
  <div class="card border-0 shadow-sm rounded-4 mb-4">
    <div class="card-body d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
      <div>
        <span class="badge bg-success rounded-pill px-3 py-2 fs-6">
          ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: {{ meter.level }}
        </span>
        <span class="ms-2 text-muted">
          ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <strong>{{ meter.points|default:0 }}</strong> pts
        </span>
      </div>
      <div class="progress-wrapper w-100 w-md-50" style="max-width: 520px;">
        <div class="d-flex justify-content-between small mb-1">
          <span>
            {% if meter.level == "Silver" %} Silver
            {% elif meter.level == "Gold" %} Gold
            {% else %} Premium {% endif %}
          </span>
          <span>{{ meter.progress_pct }}%</span>
        </div>
        <div class="progress" style="height: 10px;">
          <div class="progress-bar bg-success" style="width: {{ meter.progress_pct }}%;"></div>
        </div>
        <div class="small text-muted mt-1">
          {% if meter.next_level_name %}
            ‡∏≠‡∏µ‡∏Å <strong>{{ meter.remain_to_next }}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô <strong>{{ meter.next_level_name }}</strong>
          {% else %}
            ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß üéâ
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á -->
  {% if user.first_name and user.last_name and user.email and profile.title and profile.gender and profile.house_no and profile.moo and profile.street and profile.subdistrict and profile.district and profile.province and profile.postal_code %}
  
  <!-- ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏û‡∏® -->
    <div class="row mb-4">
      <div class="col-md-6">
        <label class="fw-semibold mb-2 d-block">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ *</label>
        <div class="d-flex gap-3">
          <div><input type="radio" name="title" {% if profile.title == '‡∏ô‡∏≤‡∏¢' %}checked{% endif %}> ‡∏ô‡∏≤‡∏¢</div>
          <div><input type="radio" name="title" {% if profile.title == '‡∏ô‡∏≤‡∏á' %}checked{% endif %}> ‡∏ô‡∏≤‡∏á</div>
          <div><input type="radio" name="title" {% if profile.title == '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß' %}checked{% endif %}> ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</div>
          <div><input type="radio" name="title" {% if profile.title == '‡∏Ñ‡∏∏‡∏ì' %}checked{% endif %}> ‡∏Ñ‡∏∏‡∏ì</div>
        </div>
      </div>
      <div class="col-md-6">
        <label class="fw-semibold mb-2 d-block">‡πÄ‡∏û‡∏® *</label>
        <div class="d-flex gap-3">
          <div><input type="radio" name="gender" {% if profile.gender == '‡∏ä‡∏≤‡∏¢' %}checked{% endif %}> ‡∏ä‡∏≤‡∏¢</div>
          <div><input type="radio" name="gender" {% if profile.gender == '‡∏´‡∏ç‡∏¥‡∏á' %}checked{% endif %}> ‡∏´‡∏ç‡∏¥‡∏á</div>
        </div>
      </div>
    </div>

    <!-- ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• -->
    <div class="row mb-4">
      <div class="col-md-6">
        <label class="fw-semibold mb-2">‡∏ä‡∏∑‡πà‡∏≠ *</label>
        <input type="text" class="form-control bg-light" value="{{ user.first_name }}" readonly>
      </div>
      <div class="col-md-6">
        <label class="fw-semibold mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
        <input type="text" class="form-control bg-light" value="{{ user.last_name }}" readonly>
      </div>
    </div>

    <!-- ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î -->
    {% comment %} <div class="row mb-4">
      <div class="col-md-12">
        <label class="fw-semibold mb-2">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î *</label>
        <div class="row g-2">
          <div class="col-md-4">
            <input type="text" class="form-control bg-light" placeholder="‡∏ß‡∏±‡∏ô" value="{{ profile.birth_day|default:'' }}" readonly>
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control bg-light" placeholder="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" value="{{ profile.birth_month|default:'' }}" readonly>
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control bg-light" placeholder="‡∏õ‡∏µ" value="{{ profile.birth_year|default:'' }}" readonly>
          </div>
        </div>
      </div>
    </div> {% endcomment %}

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
    <h6 class="fw-bold mt-4 mb-3 text-secondary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h6>
    <div class="row mb-4">
      <div class="col-md-6">
        <label class="fw-semibold mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ *</label>
        <input type="text" class="form-control bg-light" value="{{ user.phone }}" readonly>
      </div>
      <div class="col-md-6">
        <label class="fw-semibold mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
        <input type="text" class="form-control bg-light" value="{{ user.email }}" readonly>
      </div>
    </div>

    <!-- üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà -->
<div class="col-12 my-4">
  <hr>
  <h6 class="fw-bold mt-3 mb-3 text-secondary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h6>
</div>

<div class="row mb-4">
  <div class="col-md-3">
    <label class="fw-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
    <input type="text" class="form-control bg-light" value="{{ profile.house_no }}" readonly>
  </div>

  <div class="col-md-2">
    <label class="fw-semibold mb-2">‡∏´‡∏°‡∏π‡πà</label>
    <input type="text" class="form-control bg-light" value="{{ profile.moo }}" readonly>
  </div>

  <div class="col-md-7">
    <label class="fw-semibold mb-2">‡∏ñ‡∏ô‡∏ô</label>
    <input type="text" class="form-control bg-light" value="{{ profile.street }}" readonly>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-6">
    <label class="fw-semibold mb-2">‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•</label>
    <input type="text" class="form-control bg-light" value="{{ profile.subdistrict }}" readonly>
  </div>

  <div class="col-md-6">
    <label class="fw-semibold mb-2">‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
    <input type="text" class="form-control bg-light" value="{{ profile.district }}" readonly>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-6">
    <label class="fw-semibold mb-2">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
    <input type="text" class="form-control bg-light" value="{{ profile.province }}" readonly>
  </div>

  <div class="col-md-6">
    <label class="fw-semibold mb-2">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</label>
    <input type="text" class="form-control bg-light" value="{{ profile.postal_code }}" readonly>
  </div>
</div>


  {% else %}

  <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <form method="post" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- üî∏ ‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div class="card border-0 shadow-sm rounded-4 mb-4">
      <div class="card-body p-4">
        <h5 class="fw-bold text-success mb-4">
          <i class="fa fa-id-card me-2"></i> ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
        </h5>

        <div class="row g-4 align-items-end">
          <div class="col-md-2 col-sm-4">
            <label class="form-label fw-semibold text-secondary">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
            {{ form.title }}
          </div>

          <!-- üëá ‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô -->
          <div class="col-md-10 col-sm-8">
            <div class="d-flex flex-column flex-sm-row gap-3">
              <div class="flex-fill">
                <label class="form-label fw-semibold text-secondary">‡∏ä‡∏∑‡πà‡∏≠</label>
                {{ form.first_name }}
              </div>
              <div class="flex-fill">
                <label class="form-label fw-semibold text-secondary">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                {{ form.last_name }}
              </div>
            </div>
          </div>

          <div class="col-md-2 col-sm-6">
            <label class="form-label fw-semibold text-secondary">‡πÄ‡∏û‡∏®</label>
            {{ form.gender }}
          </div>
          <div class="col-md-4 col-sm-6">
            <label class="form-label fw-semibold text-secondary">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            {{ form.email }}
          </div>
          <div class="col-md-3 col-sm-6">
            <label class="form-label fw-semibold text-secondary">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            {{ form.phone }}
          </div>
        </div>
      </div>
    </div>

    <!-- üî∏ ‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà -->
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body p-4">
        <h5 class="fw-bold text-success mb-4">
          <i class="fa fa-home me-2"></i> ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠/‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
        </h5>

        <div class="row g-4">
          <div class="col-md-3 col-sm-6">
            <label class="form-label fw-semibold text-secondary">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
            {{ form.house_no }}
          </div>
          <div class="col-md-2 col-sm-6">
            <label class="form-label fw-semibold text-secondary">‡∏´‡∏°‡∏π‡πà</label>
            {{ form.moo }}
          </div>
          <div class="col-md-7">
            <label class="form-label fw-semibold text-secondary">‡∏ñ‡∏ô‡∏ô</label>
            {{ form.street }}
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold text-secondary">‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•</label>
            {{ form.subdistrict }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-secondary">‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
            {{ form.district }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-secondary">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
            {{ form.province }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-secondary">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</label>
            {{ form.postal_code }}
          </div>
        </div>
      </div>
    </div>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-success px-4 py-2 fw-semibold shadow-sm rounded-3">
        <i class="fa fa-save me-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
    </div>
  </form>
  {% endif %}
</div>

<!-- üé® Custom Style -->
<style>
  body {
    background-color: #f8f9fa;
  }

  .card {
    border-radius: 16px;
  }

  input, select {
    border-radius: 10px !important;
    border: 1px solid #ccc !important;
    padding: 10px 12px !important;
    transition: all 0.2s ease-in-out;
  }

  input:focus, select:focus {
    border-color: #198754 !important;
    box-shadow: 0 0 4px rgba(25, 135, 84, 0.4) !important;
    outline: none !important;
  }

  label.form-label {
    margin-bottom: 4px;
  }

  .btn-success {
    background-color: #198754 !important;
    border-color: #198754 !important;
    transition: all 0.2s ease-in-out;
  }

  .btn-success:hover {
    background-color: #157347 !important;
    box-shadow: 0 3px 6px rgba(25, 135, 84, 0.3);
  }

  /* üì± Responsive */
  @media (max-width: 768px) {
    .card-body {
      padding: 1.5rem !important;
    }

    h5 {
      font-size: 1.1rem;
    }

    .btn {
      width: 100%;
    }

    /* ‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    .d-flex.flex-sm-row {
      flex-direction: row !important;
    }
  }
</style>
{% endblock %}
