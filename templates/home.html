{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DDreamclinic</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { 
      font-family: 'Prompt', sans-serif; 
      background: #f8f9fa; 
    }
    .hero { 
      {% comment %} background: url('https://images.uns') no-repeat center center/cover;  {% endcomment %}
      height: 100vh; 
      display: flex; 
      align-items: center; 
      color: #ff66c8; 
      position: relative; 
    }
    .overlay { 
      position: absolute; 
      top:0; left:0; right:0; bottom:0; 
      background-color:rgba(0,0,0,0.5); 
    }
    .content-box { 
      position: relative; 
      background:white; 
      border-radius:15px; 
      box-shadow:0 0 20px rgba(0,0,0,0.2); 
      padding:30px; 
      width:380px; 
      margin-left:auto; 
      margin-right:50px; 
      color:#333; 
    }
    .btn-success { 
      background-color:#198754; 
      border:none; 
    }
    .btn-success:hover { 
      background-color:#157347; 
    }
    .toggle-btn { 
      background:none; 
      border:none; 
      color:#198754; 
      text-decoration:underline; 
      cursor:pointer; 
    }

    /* üå∏ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
    :root {
      --pink-color: #e91e63;
    }

    /* ü©∑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
    body, h1, h4, p, label, small, .form-label, .lead {
      color: var(--pink-color) !important;
    }

    /* üå∏ ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å */
    .btn-success {
      background-color: var(--pink-color) !important;
      border: none !important;
      color: white !important;
      transition: 0.3s;
    }

    /* ü§ç ‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover ‚Üí ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß + ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô */
    .btn-success:hover,
    .btn-success:active,
    .btn-success:focus {
      background-color: white !important;
      color: var(--pink-color) !important;
      border: 1px solid var(--pink-color) !important;
    }

    /* üå∏ ‡∏õ‡∏∏‡πà‡∏° toggle (‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å) */
    .toggle-btn, .btn-link, #toggle-login {
      color: var(--pink-color) !important;
      transition: 0.3s;
    }

    .toggle-btn:hover,
    .btn-link:hover,
    #toggle-login:hover {
      color: white !important;
      background-color: var(--pink-color) !important;
      border-radius: 6px;
      padding: 2px 6px;
    }

    /* ü©∑ ‡∏ä‡πà‡∏≠‡∏á input focus border */
    .form-control:focus {
      border-color: var(--pink-color);
      box-shadow: 0 0 5px rgba(233, 30, 99, 0.5);
    }

    /* ü§ç ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô + ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢) ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
    .hero .text-start h1,
    .hero .text-start p {
      color: white !important;
    }

  </style>
</head>
<body>
  <div class="hero">
    <div class="overlay"></div>
    <div class="container position-relative">
      <div class="row align-items-center">
        <div class="col-md-6 text-start">
          <h1 class="fw-bold">Ddreamclinic<br>‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢-‡∏™‡πà‡∏á</h1>
          <p class="lead">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
        </div>
        <div class="col-md-6">
          <div class="content-box" id="auth-box">
            <h4 class="text-center fw-bold mb-4" id="form-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h4>

            <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
            <form id="register-form">
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input type="text" id="register-phone" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" maxlength="10" required>
                <div id="phone-feedback" class="form-text text-danger"></div>
              </div>
              <div class="mb-3">
                <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="register-password" class="form-control" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" minlength="6" required>
              </div>
              <button type="submit" class="btn btn-success w-100" id="btn-register" disabled>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            </form>

            <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô -->
            <form id="login-form" style="display:none;">
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input type="text" id="login-phone" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
              </div>
              <div class="mb-3">
                <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="login-password" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
              </div>
              <button type="submit" class="btn btn-success w-100">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>

            <div class="text-center mt-3">
              <small id="toggle-text">
                ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß?
                <button class="toggle-btn" id="toggle-login">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const registerForm = document.getElementById('register-form');
    const loginForm = document.getElementById('login-form');
    const toggleBtn = document.getElementById('toggle-login');
    const title = document.getElementById('form-title');
    const toggleText = document.getElementById('toggle-text');
    const registerPhone = document.getElementById('register-phone');
    const phoneFeedback = document.getElementById('phone-feedback');
    const btnRegister = document.getElementById('btn-register');

    let isLoginMode = false;

    function switchForm() {
      if (isLoginMode) {
        registerForm.style.display = 'block';
        loginForm.style.display = 'none';
        title.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        toggleText.childNodes[0].textContent = '‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ';
        toggleBtn.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
        isLoginMode = false;
      } else {
        registerForm.style.display = 'none';
        loginForm.style.display = 'block';
        title.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
        toggleText.childNodes[0].textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ';
        toggleBtn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        isLoginMode = true;
      }
    }

    toggleBtn.addEventListener('click', (e) => {
      e.preventDefault();
      switchForm();
    });

    registerPhone.addEventListener('input', async () => {
      const phone = registerPhone.value.trim();
      if (phone.length !== 10 || !/^[0-9]+$/.test(phone)) {
        phoneFeedback.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô";
        phoneFeedback.classList.add('text-danger');
        phoneFeedback.classList.remove('text-success');
        btnRegister.disabled = true;
        return;
      }

      const res = await fetch(`/account/check-phone/?phone=${phone}`);
      const data = await res.json();

      if (data.exists) {
        phoneFeedback.textContent = "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ó‡∏ô";
        phoneFeedback.classList.add('text-danger');
        phoneFeedback.classList.remove('text-success');
        btnRegister.disabled = true;

        Swal.fire({
          icon: 'info',
          title: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
          timer: 2500,
          showConfirmButton: false
        });

        if (!isLoginMode) {
          switchForm();
          document.getElementById('login-phone').value = phone;
        }
      } else {
        phoneFeedback.textContent = "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏î‡πâ";
        phoneFeedback.classList.remove('text-danger');
        phoneFeedback.classList.add('text-success');
        btnRegister.disabled = false;
      }
    });

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const phone = registerPhone.value.trim();
      const password = document.getElementById('register-password').value.trim();

      const formData = new FormData();
      formData.append('phone', phone);
      formData.append('password', password);

      const res = await fetch('/account/register/', { method: 'POST', body: formData });
      const data = await res.json();

      Swal.fire({ icon: data.status, title: data.message, timer: 2000, showConfirmButton: false });

      if (data.redirect) {
        setTimeout(() => window.location.href = data.redirect, 2000);
      }
    });

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const phone = document.getElementById('login-phone').value;
      const password = document.getElementById('login-password').value;
      const formData = new FormData();
      formData.append('phone', phone);
      formData.append('password', password);

      const res = await fetch('/account/login/', { method: 'POST', body: formData });
      const data = await res.json();

      Swal.fire({ icon: data.status, title: data.message, timer: 2500, showConfirmButton: false });
      if (data.redirect) {
        setTimeout(() => window.location.href = data.redirect, 2000);
      }
    });
  </script>
</body>
</html>
