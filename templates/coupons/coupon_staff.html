{% extends 'base/base.html' %}
{% block content %}
<div class="container py-4">
  <h4 class="fw-bold text-success mb-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á (Staff)</h4>

  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h5>
      <form method="post" class="row g-3" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="create">
        <div class="col-md-4">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</label>
          <input class="form-control" name="name" required>
        </div>
          <div class="col-md-4">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</label>
          <input class="form-control" name="code" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ</label>
          <input class="form-control" type="number" name="required_points" min="0" value="0" required>
        </div>

        <div class="col-md-4">
          <label class="form-label">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
          <input class="form-control" type="datetime-local" name="expires_at" required>
        </div>
        <div class="col-md-8">
          <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea class="form-control" rows="2" name="description"></textarea>
        </div>
      
        <div class="col-md-4">
          <label class="form-label">‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</label>
          <input class="form-control" type="file" name="image" accept="image/*">
          <div class="form-text">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö jpg, png, webp ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB</div>
        </div>
        <div class="col-12 text-end">
          <button class="btn btn-success">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h5 class="fw-bold mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</h5>
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th style="width:120px;">‡∏£‡∏π‡∏õ</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠</th>
              <th>‡∏£‡∏´‡∏±‡∏™</th>
              <th>‡πÅ‡∏ï‡πâ‡∏°</th>
              <th>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
              <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th class="text-end">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody>
            {% for c in coupons %}
            <tr>
              <td>
                {% if c.image %}
                  <img src="{{ c.image.url }}" alt="coupon" class="img-thumbnail" style="width:100px;height:auto;">
                {% else %}
                  <span class="text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>
                {% endif %}
              </td>
               <td>{{ c.name }}</td>
              <td>{{ c.code }}</td>
              <td>
                {% if c.required_points is not None %}
                  {{ c.required_points }}
                {% else %}
                  <td>
  {% if not c.active %}
    <span class="badge bg-secondary">‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</span>
  {% elif c.max_uses and c.use_count >= c.max_uses %}
    <span class="badge bg-danger">‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</span>
  {% elif c.ends_at and c.ends_at|date:"U" < now|date:"U" %}
    <span class="badge bg-dark">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
  {% else %}
    <span class="badge bg-success">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</span>
  {% endif %}
</td>

                {% endif %}
              </td>
              <td>{{ c.expires_at }}</td>
              <td>
                {% if c.is_active %}
                  <span class="badge bg-success">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                {% else %}
                  <span class="badge bg-secondary">‡∏õ‡∏¥‡∏î</span>
                {% endif %}
              </td>
              <td class="text-end">
                <div class="d-flex gap-2 justify-content-end flex-wrap">
                  <form method="post" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="toggle">
                    <input type="hidden" name="coupon_id" value="{{ c.id }}">
                    <button class="btn btn-outline-primary btn-sm">‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                  </form>

                  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö -->
              <form method="POST" style="display:inline;" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="coupon_id" value="{{ c.id }}">
                <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è ‡∏•‡∏ö</button>
              </form>

                  <form method="post" enctype="multipart/form-data" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="set_image">
                    <input type="hidden" name="coupon_id" value="{{ c.id }}">
                    <input type="file" name="image" accept="image/*" class="form-control form-control-sm d-inline" style="width:180px;">
                    <button class="btn btn-outline-success btn-sm">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ</button>
                  </form>

                  {% if c.image %}
                  <form method="post" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete_image">
                    <input type="hidden" name="coupon_id" value="{{ c.id }}">
                    <button class="btn btn-outline-danger btn-sm">‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
                  </form>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
